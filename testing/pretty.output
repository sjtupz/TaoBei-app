Feature: 用户登录 # features/login.feature:1
  作为一个用户
  我想要能够登录系统
  以便访问我的账户
  Feature: 用户登录  # features/login.feature:1

  Scenario: 请求验证码时手机号格式无效                 # features/login.feature:10
    Given 系统已经启动                          # features/steps/login_steps.py:13
    And 数据库已经初始化                          # features/steps/login_steps.py:20
    Given 用户在登录页面                         # features/steps/login_steps.py:28
    When 用户在登录页面输入一个无效的手机号"123"并点击"获取验证码" # features/steps/login_steps.py:73
    Then 系统不发送验证码                         # features/steps/login_steps.py:290
      Traceback (most recent call last):
        File "C:\Users\10792\AppData\Local\Programs\Python\Python311\Lib\site-packages\behave\model.py", line 1991, in run
          match.run(runner.context)
        File "C:\Users\10792\AppData\Local\Programs\Python\Python311\Lib\site-packages\behave\matchers.py", line 105, in run
          self.func(context, *args, **kwargs)
        File "features\steps\login_steps.py", line 295, in step_system_does_not_send_verification_code
          assert get_code_button.is_enabled(), "获取验证码按钮应该仍然可点击"
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File "C:\Users\10792\AppData\Local\Programs\Python\Python311\Lib\site-packages\playwright\sync_api\_generated.py", line 17482, in is_enabled
          self._sync(self._impl_obj.is_enabled(timeout=timeout))
        File "C:\Users\10792\AppData\Local\Programs\Python\Python311\Lib\site-packages\playwright\_impl\_sync_base.py", line 115, in _sync
          return task.result()
                 ^^^^^^^^^^^^^
        File "C:\Users\10792\AppData\Local\Programs\Python\Python311\Lib\site-packages\playwright\_impl\_locator.py", line 483, in is_enabled
          return await self._frame.is_editable(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File "C:\Users\10792\AppData\Local\Programs\Python\Python311\Lib\site-packages\playwright\_impl\_frame.py", line 333, in is_editable
          return await self._channel.send("isEditable", locals_to_params(locals()))
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File "C:\Users\10792\AppData\Local\Programs\Python\Python311\Lib\site-packages\playwright\_impl\_connection.py", line 62, in send
          return await self._connection.wrap_api_call(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File "C:\Users\10792\AppData\Local\Programs\Python\Python311\Lib\site-packages\playwright\_impl\_connection.py", line 492, in wrap_api_call
          return await cb()
                 ^^^^^^^^^^
        File "C:\Users\10792\AppData\Local\Programs\Python\Python311\Lib\site-packages\playwright\_impl\_connection.py", line 100, in inner_send
          result = next(iter(done)).result()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^
      playwright._impl._errors.TimeoutError: Timeout 30000ms exceeded.

    And 页面提示"请输入正确的手机号码"                  # None
----
CAPTURED STDOUT: before_scenario
=== before_scenario 被调用 ===
开始执行场景: 请求验证码时手机号格式无效
浏览器已初始化: True
浏览器上下文已初始化: True
页面驱动已初始化: True
----
CAPTURED STDOUT: after_scenario
场景执行完成: 请求验证码时手机号格式无效
----
CAPTURED STDOUT: scenario
系统已经启动
数据库已经初始化
用户输入无效手机号: 123
---- CAPTURED_SCENARIO_OUTPUT_END ----

  Scenario: 成功获取验证码                                 # features/login.feature:16
    Given 系统已经启动                                    # features/steps/login_steps.py:13
    And 数据库已经初始化                                    # features/steps/login_steps.py:20
    Given 用户在登录页面                                   # features/steps/login_steps.py:28
    When 用户在登录页面输入一个格式正确的手机号"13800138000"并点击"获取验证码" # features/steps/login_steps.py:82
    Then 系统为该手机号生成一个6位验证码并打印在控制台                    # features/steps/login_steps.py:160
    And "获取验证码"按钮进入60秒倒计时且不可点击                      # features/steps/login_steps.py:170
      ASSERT FAILED: 获取验证码按钮应该被禁用

    And 数据库记录手机号和验证码，有效期为60秒                        # None
----
CAPTURED STDOUT: before_scenario
=== before_scenario 被调用 ===
开始执行场景: 成功获取验证码
浏览器已初始化: True
浏览器上下文已初始化: True
页面驱动已初始化: True
----
CAPTURED STDOUT: after_scenario
场景执行完成: 成功获取验证码
----
CAPTURED STDOUT: scenario
系统已经启动
数据库已经初始化
用户输入有效手机号: 13800138000，已创建验证码: 123456
生成验证码: 123456
---- CAPTURED_SCENARIO_OUTPUT_END ----

  Scenario: 使用未注册的手机号登录            # features/login.feature:23
    Given 系统已经启动                   # features/steps/login_steps.py:13
    And 数据库已经初始化                   # features/steps/login_steps.py:20
    Given 一个手机号"13900139000"未被注册   # features/steps/login_steps.py:55
    And 用户在登录页面                    # features/steps/login_steps.py:28
    When 用户使用该未注册的手机号和正确的验证码点击"登录" # features/steps/login_steps.py:103
    Then 系统不让用户登录                  # features/steps/login_steps.py:269
    And 页面提示"该手机号未注册，请先完成注册"       # features/steps/login_steps.py:299
      ASSERT FAILED: 页面应该显示消息: 该手机号未注册，请先完成注册

----
CAPTURED STDOUT: before_scenario
=== before_scenario 被调用 ===
开始执行场景: 使用未注册的手机号登录
浏览器已初始化: True
浏览器上下文已初始化: True
页面驱动已初始化: True
----
CAPTURED STDOUT: after_scenario
场景执行完成: 使用未注册的手机号登录
----
CAPTURED STDOUT: scenario
系统已经启动
数据库已经初始化
手机号 13900139000 未被注册
使用未注册手机号 13900139000 尝试登录，验证码: 123456
系统成功阻止了用户登录
未找到消息 '该手机号未注册，请先完成注册'，页面内容包含: False
当前页面URL: http://localhost:5173/login
检查页面消息失败: 页面应该显示消息: 该手机号未注册，请先完成注册
---- CAPTURED_SCENARIO_OUTPUT_END ----

  Scenario: 使用错误的验证码登录                 # features/login.feature:30
    Given 系统已经启动                       # features/steps/login_steps.py:13
    And 数据库已经初始化                       # features/steps/login_steps.py:20
    Given 一个手机号"13800138000"已被注册       # features/steps/login_steps.py:64
    And 用户在登录页面                        # features/steps/login_steps.py:28
    When 用户使用该手机号和错误的验证码"000000"点击"登录" # features/steps/login_steps.py:125
    Then 系统不让用户登录                      # features/steps/login_steps.py:269
    And 页面提示"验证码错误"                    # features/steps/login_steps.py:299
      ASSERT FAILED: 页面应该显示消息: 验证码错误

----
CAPTURED STDOUT: before_scenario
=== before_scenario 被调用 ===
开始执行场景: 使用错误的验证码登录
浏览器已初始化: True
浏览器上下文已初始化: True
页面驱动已初始化: True
----
CAPTURED STDOUT: after_scenario
场景执行完成: 使用错误的验证码登录
----
CAPTURED STDOUT: scenario
系统已经启动
数据库已经初始化
手机号 13800138000 已被注册
使用手机号 13800138000 和错误验证码 000000 尝试登录
系统成功阻止了用户登录
未找到消息 '验证码错误'，页面内容包含: False
当前页面URL: http://localhost:5173/login
检查页面消息失败: 页面应该显示消息: 验证码错误
---- CAPTURED_SCENARIO_OUTPUT_END ----

  Scenario: 成功登录                 # features/login.feature:37
    Given 系统已经启动                 # features/steps/login_steps.py:13
    And 数据库已经初始化                 # features/steps/login_steps.py:20
    Given 一个手机号"13800138000"已被注册 # features/steps/login_steps.py:64
    And 用户在登录页面                  # features/steps/login_steps.py:28
    When 用户使用该手机号和正确的验证码点击"登录"   # features/steps/login_steps.py:137
    Then 系统验证成功                  # features/steps/login_steps.py:205
    And 页面提示"登录成功"               # features/steps/login_steps.py:299
      ASSERT FAILED: 页面应该显示消息: 登录成功

    And 页面自动跳转到首页                # None
----
CAPTURED STDOUT: before_scenario
=== before_scenario 被调用 ===
开始执行场景: 成功登录
浏览器已初始化: True
浏览器上下文已初始化: True
页面驱动已初始化: True
----
CAPTURED STDOUT: after_scenario
场景执行完成: 成功登录
----
CAPTURED STDOUT: scenario
系统已经启动
数据库已经初始化
手机号 13800138000 已被注册
使用手机号 13800138000 和正确验证码 123456 登录
系统验证成功，没有发现错误提示
未检测到JavaScript弹窗，尝试其他方式验证登录成功
当前页面URL: http://localhost:5173/login
等待后的页面URL: http://localhost:5173/login
未找到消息 '登录成功'，页面内容包含: False
当前页面URL: http://localhost:5173/login
检查页面消息失败: 页面应该显示消息: 登录成功
---- CAPTURED_SCENARIO_OUTPUT_END ----

